import { LogUtil } from '@pura/harmony-utils'
import promptAction from '@ohos.promptAction'
import { TomatoClockViewModel } from '../viewmodel/TomatoClockViewModel'
import { RestViewModel } from '../viewmodel/RestViewModel'
import { TomatoClock } from '../view/TomatoClock'
import { RestClock } from '../view/RestClock'
import { ClockData, FocusDataUtil, FocusPreferenceName } from '../utils/FocusDataUtil'

// å®šä¹‰å‚æ•°ç±»å‹
export interface RouterParams {
  tomatoNum: number,
  tomatoDuration: number,
  tomatoModel: number,
  isAutoRested: boolean,
  isStrict: boolean,
  title: string,
  restDuration: number,
}

/**
 * ç•ªèŒ„é’Ÿé¡µé¢ - å®Œæ•´ç¤ºä¾‹(ä½¿ç”¨SVGAæ‰©æ•£åœ†ç¯åŠ¨ç”»)
 * 
 * @author kedongjun
 * @since 2025-01-27
 */
@Entry
@Component
struct TomatoClockPage {
  // ============ ViewModel ============
  private tomatoViewModel: TomatoClockViewModel = new TomatoClockViewModel()
  private restViewModel: RestViewModel = new RestViewModel()
  
  // ============ ç•ªèŒ„é’ŸçŠ¶æ€ ============
  @State tomatoNum: number = 4
  @State currentSegment: number = 0
  @State elapsedTime: number = 0
  @State tomatoDuration: number = 30
  @State isPaused: boolean = false
  @State isDone: boolean = false
  @State useTime: number = 0
  
  // ============ ä¼‘æ¯çŠ¶æ€ ============
  @State restDuration: number = 10
  @State currentRestSeconds: number = 0
  @State isResting: boolean = false
  
  // ğŸ†• å»¶é•¿é˜¶æ®µçŠ¶æ€
  @State isExtension: boolean = false
  
  aboutToAppear() {
    // ========== æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢å¤çŠ¶æ€ ==========
    const clockData = FocusDataUtil.getClockData(FocusPreferenceName.Tomato)
    const isResuming = clockData.startTimestamp !== 0
    
    // ========== åˆå§‹åŒ–ç•ªèŒ„é’Ÿ ==========
    const params = this.getUIContext().getRouter().getParams() as RouterParams;
    
    if (isResuming) {
      // ğŸ”§ æ¢å¤æ¨¡å¼ï¼šä»ç¼“å­˜è¯»å–é…ç½®
      LogUtil.debug('ç•ªèŒ„é’Ÿ,æ¢å¤æ¨¡å¼,ä»ç¼“å­˜è¯»å–é…ç½®')
      this.tomatoViewModel.tomatoNum = clockData.tomatoNum
      this.tomatoViewModel.tomatoDuration = clockData.tomatoDuration
      this.tomatoViewModel.restDuration = clockData.restDuration
      this.tomatoViewModel.tomatoModel = clockData.tomatoModel
      this.tomatoViewModel.isAutoRested = clockData.isAutoRested
      this.tomatoViewModel.isStrict = clockData.isStrict
      this.tomatoViewModel.title = clockData.title
      
      // è®¾ç½®é¡µé¢é…ç½®
      this.restDuration = clockData.restDuration
      this.currentRestSeconds = clockData.currentRestSeconds
      this.tomatoDuration = clockData.tomatoDuration
      this.tomatoNum = clockData.tomatoNum
    } else if (params) {
      // ğŸ”§ é¦–æ¬¡å¯åŠ¨ï¼šä»è·¯ç”±å‚æ•°è¯»å–é…ç½®
      LogUtil.debug('ç•ªèŒ„é’Ÿ,é¦–æ¬¡å¯åŠ¨,ä»å‚æ•°è¯»å–é…ç½®,params====' + JSON.stringify(params))
      this.tomatoViewModel.tomatoNum = params.tomatoNum;
      this.tomatoViewModel.tomatoDuration = params.tomatoDuration;
      this.tomatoViewModel.tomatoModel = params.tomatoModel;
      this.tomatoViewModel.isAutoRested = params.isAutoRested;
      this.tomatoViewModel.isStrict = params.isStrict;
      this.tomatoViewModel.title = params.title;
      this.tomatoViewModel.restDuration = params.restDuration;
      
      // ğŸ”§ ä¿®å¤ï¼šè®¾ç½®é¡µé¢çš„ä¼‘æ¯æ—¶é•¿
      this.restDuration = params.restDuration;
      this.tomatoDuration = params.tomatoDuration;
      this.tomatoNum = params.tomatoNum;
      
      // åˆå§‹åŒ–ç¼“å­˜æ•°æ®
      this.tomatoViewModel.initClockData()
    }
    
    // è®¾ç½®çŠ¶æ€å˜åŒ–å›è°ƒ
    this.tomatoViewModel.onStateChange(() => {
      this.syncTomatoState()
    })
    
    // è®¾ç½®æ®µå®Œæˆå›è°ƒ - è¿›å…¥ä¼‘æ¯
    this.tomatoViewModel.onSegmentComplete((current, total) => {
      LogUtil.debug(`å®Œæˆç¬¬ ${current}/${total} ä¸ªç•ªèŒ„`)
      
      if (current < total) {
        // ğŸ†• è®°å½•"å¼€å§‹ç¬¬Nä¸ªä¼‘æ¯"äº‹ä»¶
        // this.tomatoViewModel.addFocusEvent(5, `å¼€å§‹ç¬¬${current}æ¬¡ä¼‘æ¯`, 0)
        this.enterRestMode(current)
      }
    })
    
    // è®¾ç½®å…¨éƒ¨å®Œæˆå›è°ƒ
    this.tomatoViewModel.onAllComplete(() => {
      LogUtil.debug('æ‰€æœ‰ç•ªèŒ„å®Œæˆ!')
      this.isExtension = true  // ğŸ†• æ˜¾ç¤ºå»¶é•¿ç»„ä»¶
      promptAction.showToast({
        message: 'ğŸ‰ æ­å–œå®Œæˆæ‰€æœ‰ç•ªèŒ„!',
        duration: 3000
      })
    })
    
    // ========== åˆå§‹åŒ–ä¼‘æ¯ ==========
    this.restViewModel.restTime = this.restDuration
    
    this.restViewModel.onStateChange(() => {
      this.syncRestState()
    })
    
    // è®¾ç½®ä¼‘æ¯å®Œæˆå›è°ƒ - ç»§ç»­ä¸‹ä¸€ä¸ªç•ªèŒ„
    this.restViewModel.onRestComplete(() => {
      LogUtil.debug('ä¼‘æ¯å®Œæˆ')
      this.exitRestMode()
    })
    
    // ğŸ†• å¦‚æœæ˜¯æ¢å¤çŠ¶æ€,éœ€è¦è®¡ç®—ç¦»çº¿æ—¶é—´å¹¶æ¢å¤
    if (isResuming) {
      this.restoreFromCache(clockData)
    } else {
      // è‡ªåŠ¨å¼€å§‹ç¬¬ä¸€ä¸ªç•ªèŒ„
      this.tomatoViewModel.start()
    }
  }
  
  aboutToDisappear() {
    this.tomatoViewModel.destroy()
    this.restViewModel.destroy()
  }
  
  /**
   * ğŸ†• ä»ç¼“å­˜æ¢å¤çŠ¶æ€(å¤„ç†æ€è¿›ç¨‹æ¢å¤)
   */
  private restoreFromCache(clockData: ClockData) {
    LogUtil.debug('======= ä»ç¼“å­˜æ¢å¤çŠ¶æ€ =======')
    LogUtil.debug('ç¼“å­˜æ•°æ®: ' + JSON.stringify(clockData))
    
    // ğŸ”§ å…ˆæ¢å¤æ‰€æœ‰é…ç½®å‚æ•°ï¼ˆä»ç¼“å­˜ä¸­è¯»å–ï¼‰
    this.tomatoNum = clockData.tomatoNum
    this.tomatoDuration = clockData.tomatoDuration
    this.restDuration = clockData.restDuration
    this.currentRestSeconds = clockData.currentRestSeconds

    // æ¢å¤ViewModelçŠ¶æ€
    this.tomatoViewModel.tomatoNum = clockData.tomatoNum
    this.tomatoViewModel.tomatoDuration = clockData.tomatoDuration
    this.tomatoViewModel.restDuration = clockData.restDuration
    this.tomatoViewModel.currentTomato = clockData.currentTomato
    this.tomatoViewModel.useTime = clockData.useTime
    this.tomatoViewModel.isPaused = clockData.isPaused
    this.tomatoViewModel.isDone = clockData.isDone
    this.tomatoViewModel.isExtension = clockData.isExtension
    this.tomatoViewModel.isResting = clockData.isResting  // ğŸ”§ æ¢å¤ä¼‘æ¯çŠ¶æ€
    
    // æ¢å¤restæ•°æ®
    this.restViewModel.restTime = clockData.restDuration
    this.restViewModel.elapsedTime = clockData.currentRestSeconds

    // è®¡ç®—ç¦»çº¿æ—¶é—´
    const now = Date.now()
    const offlineSeconds = (now - clockData.eventTimestamp) / 1000
    LogUtil.debug(`ç¦»çº¿æ—¶é—´: ${offlineSeconds}ç§’`)
    LogUtil.debug(`ä¼‘æ¯æ—¶é•¿é…ç½®: ${clockData.restDuration}ç§’`)
    LogUtil.debug(`å½“å‰çŠ¶æ€: isResting=${clockData.isResting}, currentRestSeconds=${clockData.currentRestSeconds}`)
    
    // ğŸ†• æ ¹æ®çŠ¶æ€æ¢å¤åˆ°æ­£ç¡®ä½ç½®
    if (clockData.isExtension) {
      // åœ¨å»¶é•¿é˜¶æ®µ
      LogUtil.debug('æ¢å¤åˆ°å»¶é•¿é˜¶æ®µ')
      this.isExtension = true
      this.syncTomatoState()
    } else if (clockData.isResting) {
      // åœ¨ä¼‘æ¯ä¸­
      LogUtil.debug('æ¢å¤åˆ°ä¼‘æ¯é˜¶æ®µ')
      const expectedRestElapsed = clockData.currentRestSeconds + offlineSeconds
      
      LogUtil.debug(`é¢„æœŸå·²ä¼‘æ¯æ—¶é—´: ${expectedRestElapsed}ç§’ (ç¼“å­˜${clockData.currentRestSeconds}ç§’ + ç¦»çº¿${offlineSeconds}ç§’)`)
      LogUtil.debug(`ä¼‘æ¯æ€»æ—¶é•¿: ${clockData.restDuration}ç§’`)
      
      if (expectedRestElapsed >= clockData.restDuration) {
        // ä¼‘æ¯å·²ç»åº”è¯¥ç»“æŸ,è¿›å…¥ä¸‹ä¸€ä¸ªç•ªèŒ„
        LogUtil.debug('ä¼‘æ¯å·²ç»“æŸ,è¿›å…¥ä¸‹ä¸€ä¸ªç•ªèŒ„')
        this.isResting = false
        this.tomatoViewModel.isResting = false
        this.tomatoViewModel.addFocusEvent(4, `å¼€å§‹ç¬¬${clockData.currentTomato + 1}ä¸ªç•ªèŒ„`, 0)
        this.tomatoViewModel.start()
        this.syncTomatoState()
      } else {
        // ğŸ”§ ä¿®å¤ï¼šç»§ç»­ä¼‘æ¯ï¼Œä½¿ç”¨ restoreAndContinue æ–¹æ³•
        LogUtil.debug(`ç»§ç»­ä¼‘æ¯ï¼Œå·²ä¼‘æ¯${expectedRestElapsed}ç§’`)
        this.isResting = true  // è®¾ç½®é¡µé¢çŠ¶æ€ä¸ºä¼‘æ¯ä¸­
        this.restViewModel.restoreAndContinue(expectedRestElapsed)
        this.syncRestState()  // ğŸ”§ åªåŒæ­¥ä¼‘æ¯çŠ¶æ€ï¼Œä¸è°ƒç”¨ syncTomatoState
        // ğŸ”§ æ‰‹åŠ¨åŒæ­¥ç•ªèŒ„çŠ¶æ€ï¼ˆä¸åŒ…æ‹¬ isRestingï¼‰
        this.currentSegment = this.tomatoViewModel.currentTomato
        this.elapsedTime = this.tomatoViewModel.currentTomatoSeconds
        this.isPaused = this.tomatoViewModel.isPaused
        this.isDone = this.tomatoViewModel.isDone
        this.useTime = this.tomatoViewModel.useTime
        this.isExtension = this.tomatoViewModel.isExtension
      }
    } else {
      // åœ¨ç•ªèŒ„é’Ÿä¸­
      LogUtil.debug('æ¢å¤åˆ°ç•ªèŒ„é’Ÿé˜¶æ®µ')
      const expectedTomatoElapsed = clockData.currentTomatoSeconds + offlineSeconds
      
      if (expectedTomatoElapsed >= clockData.tomatoDuration) {
        // ç•ªèŒ„åº”è¯¥å·²ç»å®Œæˆ
        const completedTomatoes = Math.floor(expectedTomatoElapsed / clockData.tomatoDuration)
        LogUtil.debug(`åº”è¯¥å®Œæˆäº†${completedTomatoes}ä¸ªç•ªèŒ„`)
        
        // ğŸ”§ ä¿®å¤ï¼šå…ˆè®¾ç½®æ­£ç¡®çš„æ—¶é—´ï¼Œå†è§¦å‘é€’å½’åŒæ­¥
        this.tomatoViewModel.restoreAndContinue(expectedTomatoElapsed)
        setTimeout(() => {
          this.recursiveSync()
        }, 100)
      } else {
        // ğŸ”§ ä¿®å¤ï¼šç»§ç»­å½“å‰ç•ªèŒ„ï¼Œä½¿ç”¨ restoreAndContinue æ–¹æ³•
        LogUtil.debug(`ç»§ç»­ç¬¬${clockData.currentTomato + 1}ä¸ªç•ªèŒ„ï¼Œå·²ç”¨æ—¶${expectedTomatoElapsed}ç§’`)
        this.tomatoViewModel.restoreAndContinue(expectedTomatoElapsed)
      }
      
      this.syncTomatoState()  // ç•ªèŒ„é’ŸçŠ¶æ€æ‰è°ƒç”¨ syncTomatoState
    }
  }
  
  /**
   * é¡µé¢æ˜¾ç¤º - å¤„ç†äº®å±åçš„æ—¶é—´æ ¡å‡†
   */
  onPageShow() {
    LogUtil.debug('======= é¡µé¢æ˜¾ç¤º - å¼€å§‹æ—¶é—´æ ¡å‡† =======')
    this.recursiveSync()
  }
  
  /**
   * é€’å½’æ ¡å‡† - å¤„ç†æ‰€æœ‰åº”è¯¥å®Œæˆçš„ç•ªèŒ„å’Œä¼‘æ¯
   */
  private recursiveSync() {
    if (this.isDone && !this.isExtension) {
      LogUtil.debug('å·²å…¨éƒ¨å®Œæˆä¸”ä¸åœ¨å»¶é•¿é˜¶æ®µ,åœæ­¢æ ¡å‡†')
      return
    }
    
    if (this.isResting) {
      const shouldContinue = this.restViewModel.checkAndSync()
      
      if (shouldContinue) {
        setTimeout(() => {
          this.recursiveSync()
        }, 50)
      }
    } else if (!this.isExtension) {
      const shouldContinue = this.tomatoViewModel.checkAndSync()
      
      if (shouldContinue) {
        setTimeout(() => {
          this.recursiveSync()
        }, 50)
      }
    }
  }
  
  onPageHide() {
    LogUtil.debug('é¡µé¢éšè— - æ¯å±æˆ–åå°')
  }
  
  private syncTomatoState() {
    this.tomatoNum = this.tomatoViewModel.tomatoNum
    this.currentSegment = this.tomatoViewModel.currentTomato
    this.elapsedTime = this.tomatoViewModel.currentTomatoSeconds
    this.tomatoDuration = this.tomatoViewModel.tomatoDuration
    this.isPaused = this.tomatoViewModel.isPaused
    this.isDone = this.tomatoViewModel.isDone
    this.useTime = this.tomatoViewModel.useTime
    this.isExtension = this.tomatoViewModel.isExtension
  }
  
  private syncRestState() {
    this.currentRestSeconds = this.restViewModel.elapsedTime
    
    // ğŸ”§ å¦‚æœæ­£åœ¨ä¼‘æ¯ï¼Œä¿å­˜ä¼‘æ¯è¿›åº¦åˆ°ç¼“å­˜
    if (this.isResting) {
      let clockData = FocusDataUtil.getClockData(FocusPreferenceName.Tomato)
      clockData.currentRestSeconds = this.restViewModel.elapsedTime
      clockData.eventTimestamp = Date.now()
      FocusDataUtil.saveClockData(FocusPreferenceName.Tomato, clockData)
    }
  }
  
  /**
   * è¿›å…¥ä¼‘æ¯æ¨¡å¼
   */
  private enterRestMode(restIndex: number) {
    LogUtil.debug(`è¿›å…¥ä¼‘æ¯æ¨¡å¼ï¼Œä¼‘æ¯æ—¶é•¿ï¼š${this.restDuration}ç§’`)
    this.isResting = true
    this.tomatoViewModel.isResting = true  // ğŸ”§ è®¾ç½®ViewModelçŠ¶æ€
    
    // ğŸ”§ ä¿å­˜ä¼‘æ¯çŠ¶æ€åˆ°ç¼“å­˜
    let clockData = FocusDataUtil.getClockData(FocusPreferenceName.Tomato)
    this.tomatoViewModel.isResting = true
    this.tomatoViewModel.currentRestSeconds = 0  // åˆšå¼€å§‹ä¼‘æ¯
    this.tomatoViewModel.currentRest = restIndex
    // this.tomatoViewModel.eventTimestamp = Date.now()
    // FocusDataUtil.saveClockData(FocusPreferenceName.Tomato, clockData)
    this.tomatoViewModel.addFocusEvent(5, `å¼€å§‹ç¬¬${restIndex}ä¸ªä¼‘æ¯`, Date.now())

    // ğŸ”§ è®¾ç½®ä¼‘æ¯æ—¶é•¿å’Œåºå·
    this.restViewModel.restTime = this.restDuration
    this.restViewModel.setRestIndex(restIndex)
    this.restViewModel.start()
    
    LogUtil.debug(`RestViewModel.restTime è®¾ç½®ä¸ºï¼š${this.restViewModel.restTime}ç§’`)
    
    promptAction.showToast({
      message: `å®Œæˆç¬¬ ${this.currentSegment} ä¸ªç•ªèŒ„!ä¼‘æ¯ ${this.restDuration} ç§’`,
      duration: 2000
    })
  }
  
  /**
   * é€€å‡ºä¼‘æ¯æ¨¡å¼
   */
  private exitRestMode() {
    LogUtil.debug('é€€å‡ºä¼‘æ¯æ¨¡å¼,ç»§ç»­ç•ªèŒ„é’Ÿ')
    this.isResting = false
    this.tomatoViewModel.isResting = false  // ğŸ”§ æ¸…é™¤ViewModelçŠ¶æ€
    this.restViewModel.reset()
    
    // ğŸ”§ æ¸…é™¤ä¼‘æ¯çŠ¶æ€ç¼“å­˜
    this.tomatoViewModel.isResting = false
    this.tomatoViewModel.currentRestSeconds = 0

    
    // ğŸ†• è®°å½•"å¼€å§‹ç¬¬Nä¸ªç•ªèŒ„"äº‹ä»¶
    // this.tomatoViewModel.addFocusEvent(4, `å¼€å§‹ç¬¬${this.currentSegment + 1}ä¸ªç•ªèŒ„`, 0)
    
    // ğŸ”§ ä¿®å¤ï¼šé‡ç½®ç•ªèŒ„çŠ¶æ€ï¼Œå¼€å§‹æ–°çš„ç•ªèŒ„
    this.tomatoViewModel.currentTomatoSeconds = 0
    this.tomatoViewModel.isPaused = false
    this.tomatoViewModel.resume()
    
    promptAction.showToast({
      message: 'å¼€å§‹æ–°çš„ç•ªèŒ„!',
      duration: 1500
    })
  }
  
  private formatTotalTime(seconds: number): string {
    const hours = Math.floor(seconds / 3600)
    const mins = Math.floor((seconds % 3600) / 60)
    const secs = Math.floor(seconds % 60)
    
    if (hours > 0) {
      return `${hours}æ—¶${mins}åˆ†${secs}ç§’`
    } else if (mins > 0) {
      return `${mins}åˆ†${secs}ç§’`
    } else {
      return `${secs}ç§’`
    }
  }
  
  build() {
    Stack() {
      if (this.isResting) {
        // ========== ä¼‘æ¯ç•Œé¢(SVGAæ‰©æ•£åŠ¨ç”»)==========
        RestClock({
          restTime: this.restDuration,
          elapsedTime: this.currentRestSeconds,
          onSkip: () => {
            this.restViewModel.skip()
          },
          onFinish: () => {
            this.restViewModel.skip()
          }
        })
      } else if (this.isExtension) {
        // ğŸ†• ========== å»¶é•¿ç»„ä»¶ ==========
        Column() {
          Text('ğŸ‰ æ­å–œå®Œæˆ!')
            .fontSize(32)
            .fontColor(Color.White)
            .fontWeight(FontWeight.Bold)
            .margin({ top: 60, bottom: 40 })
          
          Column() {
            Text(`å·²å®Œæˆ ${this.tomatoNum} ä¸ªç•ªèŒ„`)
              .fontSize(20)
              .fontColor(Color.White)
              .margin({ bottom: 16 })
            
            Text(`æ€»ç”¨æ—¶: ${this.formatTotalTime(this.useTime)}`)
              .fontSize(18)
              .fontColor('#CCFFFFFF')
              .margin({ bottom: 40 })
            
            Text('ç»§ç»­ä¿æŒä¸“æ³¨?')
              .fontSize(16)
              .fontColor('#CCFFFFFF')
              .margin({ bottom: 24 })
            
            Row() {
              Button('å»¶é•¿ +1')
                .fontSize(16)
                .fontColor('#1a4d6d')
                .backgroundColor(Color.White)
                .width(120)
                .height(50)
                .borderRadius(25)
                .onClick(() => {
                  this.tomatoViewModel.extend(1)
                })
                .margin({ right: 15 })
              
              Button('å®Œæˆä»»åŠ¡')
                .fontSize(16)
                .fontColor(Color.White)
                .backgroundColor('rgba(255, 255, 255, 0.1)')
                .border({ width: 1, color: Color.White, radius: 25 })
                .width(120)
                .height(50)
                .onClick(() => {
                  // ğŸ†• å®Œæˆä»»åŠ¡,æ¸…ç©ºç¼“å­˜,è¿”å›é¦–é¡µ
                  this.tomatoViewModel.finishTask()
                  
                  promptAction.showToast({
                    message: 'ä»»åŠ¡å·²å®Œæˆ!',
                    duration: 2000
                  })
                  
                  this.getUIContext().getRouter().back()
                })
            }
            .justifyContent(FlexAlign.Center)
          }
          .width('90%')
          .padding(30)
          .backgroundColor('rgba(255, 255, 255, 0.05)')
          .borderRadius(20)
        }
        .width('100%')
        .height('100%')
        .justifyContent(FlexAlign.Center)
        .linearGradient({
          angle: 180,
          colors: [[0x1a4d6d, 0.0], [0x0d2639, 1.0]]
        })
      } else {
        // ========== ç•ªèŒ„é’Ÿç•Œé¢ ==========
        Column() {
          Text('ç•ªèŒ„é’Ÿä¸“æ³¨')
            .fontSize(24)
            .fontColor(Color.White)
            .fontWeight(FontWeight.Bold)
            .margin({ top: 40, bottom: 20 })
          
          TomatoClock({
            tomatoNum: this.tomatoNum,
            currentSegment: this.currentSegment,
            elapsedTime: this.elapsedTime,
            segmentTime: this.tomatoDuration
          })
            .margin({ top: 40, bottom: 40 })
          
          Column() {
            Text(`å½“å‰: ç¬¬ ${this.currentSegment + 1}/${this.tomatoNum} ä¸ªç•ªèŒ„`)
              .fontSize(16)
              .fontColor(Color.White)
              .margin({ bottom: 8 })
            
            Text(`æ€»ç”¨æ—¶: ${this.formatTotalTime(this.useTime)}`)
              .fontSize(14)
              .fontColor('#CCFFFFFF')
              .margin({ bottom: 8 })
            
            Text(this.isDone ? 'âœ… å·²å®Œæˆ' : (this.isPaused ? 'â¸ï¸ å·²æš‚åœ' : 'â–¶ï¸ è¿›è¡Œä¸­'))
              .fontSize(14)
              .fontColor(this.isDone ? '#4CAF50' : (this.isPaused ? '#FF9800' : '#2196F3'))
          }
          .margin({ bottom: 40 })
          
          Row() {
            Button(this.isPaused ? 'ç»§ç»­' : 'æš‚åœ')
              .onClick(() => {
                this.tomatoViewModel.togglePause()
              })
              .enabled(!this.isDone)
              .margin({ right: 10 })
            
            Button('é‡ç½®')
              .onClick(() => {
                this.tomatoViewModel.reset()
                this.tomatoViewModel.start()
              })
              .margin({ right: 10 })
            
            Button('å»¶é•¿+1')
              .onClick(() => {
                this.tomatoViewModel.extend(1)
              })
          }
          .margin({ bottom: 20 })

        }
        .width('100%')
        .height('100%')
        .linearGradient({
          angle: 180,
          colors: [[0x1a4d6d, 0.0], [0x0d2639, 1.0]]
        })
      }
    }
    .width('100%')
    .height('100%')
  }
}
